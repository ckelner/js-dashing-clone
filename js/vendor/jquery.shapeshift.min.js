(function(e,c,g){var d="shapeshift",a=c.document,f={centerGrid:true,enableAnimation:true,enableAutoHeight:true,enableDrag:true,enableDragAnimation:true,enableRearrange:true,enableResize:true,animateSpeed:150,columns:null,dragClone:false,dragRate:100,dragWhitelist:"*",dropCutoff:0,dropWhitelist:"*",gutterX:10,gutterY:10,minHeight:100,paddingY:0,paddingX:0,selector:""};function b(j,h){var i=this;i.container=e(j);i.options=e.extend({},f,h);i.init()}b.prototype.init=function(){var h=this;h.eventSetup();h.container.trigger("ss-event-arrange")};b.prototype.eventSetup=function(){var i=this,h=i.options;i.container.attr("data-ss-rearrangeable",h.enableRearrange);i.container.off("ss-event-arrange").on("ss-event-arrange",function(){i.arrange()});i.container.off("ss-event-dragreset").on("ss-event-dragreset",function(){i.dragClear();i.drag()});if(h.enableDrag){i.container.trigger("ss-event-dragreset")}if(h.enableResize){i.resize()}};b.prototype.arrange=function(){var k=this,i=k.options,j=k.container.children(i.selector).filter(":visible"),h=k.getPositions(k.container,false),l=true;if(j.filter(".ss-moving")[0]){l=i.enableDragAnimation}else{l=i.enableAnimation}for(var n=0;n<h.length;n++){var m=e(j[n]);if(!m.hasClass("ss-moving")){if(l){m.stop(true,false).animate(h[n],i.animateSpeed)}else{m.css(h[n])}}}k.container.css("height",i.containerHeight)};b.prototype.drag=function(){var q=this,r=q.options;$curContainer=q.container;var k=q.container.children(r.selector),h=null,m=null,p=false;k.filter(r.dragWhitelist).draggable({addClasses:false,containment:"document",zIndex:9999,drag:function(t,s){l(t,s)},start:function(t,s){i(t,s)},stop:function(t,s){o(t)}});function i(t,s){h=e(t.target);$curContainer=h.parent();if(r.dragClone){$clone=h.clone().insertBefore(h).addClass("ss-clone")}h.addClass("ss-moving")}function o(s){$clone=e(".ss-clone");if($clone[0]){$cloneContainer=$clone.parent();if($cloneContainer[0]===h.parent()[0]){$clone.remove()}else{$clone.removeClass("ss-clone");$cloneContainer.trigger("ss-event-dragreset");h.parent().trigger("ss-event-dragreset")}}e(s.target).removeClass("ss-moving").parent().trigger("ss-event-arrange")}function l(t,s){if(!p&&$curContainer.data("ss-rearrangeable")){p=true;m=q.getIntendedPosition(t);k=$curContainer.children(":not(.ss-moving):visible");if(m!=k.size()){$target=k.get(m);h.insertBefore($target)}else{$target=k.get(m-1);h.insertAfter($target)}if(!$target){h.appendTo($curContainer)}$curContainer.trigger("ss-event-arrange");e(".ss-prev-container").trigger("ss-event-arrange");c.setTimeout(function(){p=false},r.dragRate)}s.position.left=t.pageX-e(t.target).parent().offset().left-(r.childWidth/2);s.position.top=t.pageY-e(t.target).parent().offset().top-(h.outerHeight()/2)}q.container.droppable({accept:r.dropWhitelist,drop:function(s){j(s)},over:function(s){n(s)}});function j(s){h=e(".ss-moving").removeClass("ss-moving");$selectedContainer=h.parent();$selectedContainer.trigger("ss-event-arrange").trigger("ss-event-dropped",h)}function n(s){$curContainer.addClass("ss-prev-container");$curContainer=e(s.target).removeClass("ss-prev-container")}};b.prototype.dragClear=function(){this.container.droppable().droppable("destroy");this.container.children().draggable().draggable("destroy")};b.prototype.getPositions=function(w,r){var x=this,y=x.options,q=w.children(y.selector).filter(":visible"),l=y.columns,u=[],p=null,t=y.paddingX,o=[];if(r){q=q.not(".ss-moving")}y.childWidth=q.first().outerWidth(true);p=y.childWidth+y.gutterX;if(!l){l=Math.floor(w.innerWidth()/p);if(l>q.length){l=q.length}}if(y.centerGrid){t=Math.floor((w.innerWidth()-(l*p))/2)+(y.gutterX/2)}for(var n=0;n<l;n++){u.push(y.paddingY)}for(var k=0;k<q.length;k++){var h=e(q[k]),j=e.inArray(Math.min.apply(c,u),u),v=h.outerHeight(true)+y.gutterY,s=(p*j)+t,m=u[j];attributes={left:s,top:m};o[k]=attributes;u[j]+=v}if(y.enableAutoHeight){v=Math.max.apply(Math,u);if(v<y.minHeight){v=y.minHeight}y.containerHeight=v}return o};b.prototype.getIntendedPosition=function(n){var u=this,v=u.options,i=e(".ss-moving"),s=i.parent(),t=0,p=i.position().left+(v.childWidth/2),o=i.position().top+(i.outerHeight()/2),r=9999,k=u.getPositions(s,true),j=k.length-v.dropCutoff;for(var h=0;h<k.length;h++){if(h<j){attributes=k[h];if(p>attributes.left&&o>attributes.top){var m=p-attributes.left,l=o-attributes.top;distance=Math.sqrt((m*m)+(l*l));if(distance<r){r=distance;t=h;if(h===k.length-1){var q=s.children().not(".ss-moving").last();if(l>(q.outerHeight()*0.9)||m>v.childWidth*0.9){t++}}}}}}return t};b.prototype.resize=function(){var i=this,h=false;e(c).on("resize",function(){if(!h){h=true;setTimeout(function(){h=false;i.container.trigger("ss-event-arrange")},75)}})};e.fn[d]=function(h){return this.each(function(){e.data(this,"plugin_"+d,new b(this,h))})}}(jQuery,window));